{% extends "veterinarian_dashboard/base_dashboard.html" %}

{% block dashboard_content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
  <div class="w-full px-4 sm:px-6 md:px-12 py-12 mx-auto">

<!-- Header -->
<header class="mb-12 w-full bg-gradient-to-r from-blue-100 via-white to-blue-100 bg-opacity-70 backdrop-blur-md rounded-2xl p-8 shadow-xl transition-all duration-300">
  <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between">

    <!-- Left: Title with stethoscope icon -->
    <div class="flex items-center gap-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 hover:scale-105 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-4-4V7a4 4 0 014-4h10a4 4 0 014 4v5a4 4 0 01-4 4H7z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6" />
      </svg>
      <h1 class="text-4xl font-bold text-gray-900 tracking-tight select-none">Veterinarian</h1>
    </div>

    <!-- Center: Welcome + Branch -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:gap-10 text-gray-700 text-base sm:text-lg">

      <!-- Welcome user -->
      <p class="flex items-center gap-2" aria-label="Welcome message">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 hover:text-gray-700 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M2 20c0-4 4-6 10-6s10 2 10 6" />
        </svg>
        <span>Welcome back,</span>
        <span class="font-semibold text-gray-900 select-text">Dr. {{ request.user.get_full_name|default:request.user.username }}</span>
      </p>

      <!-- Branch info -->
      <p class="flex items-center gap-2 text-blue-600 font-semibold tracking-wide select-none" aria-label="Branch location">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hover:text-blue-800 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.104 0 2-.896 2-2s-.896-2-2-2-2 .896-2 2 .896 2 2 2z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 22s8-4.5 8-10-3.582-8-8-8-8 3.582-8 8 8 10 8 10z" />
        </svg>
        <span>{{ branch|title }}</span>
      </p>
    </div>

    <!-- Right: Online Status -->
    <div id="online-status" class="flex items-center gap-2 text-gray-600 text-sm font-medium select-none" aria-label="Online status">
      <svg id="status-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 animate-pulse drop-shadow hover:scale-105 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 12.55a11 11 0 0114.08 0m-2.83 2.82a7 7 0 00-8.42 0m4.24 4.24a3 3 0 00-4.24 0" />
      </svg>
      <span id="status-text">Online</span>
    </div>

  </div>
</header>



    <br>
    <br>

    <!-- Stats Overview -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-20 w-full">
      <div class="bg-white rounded-2xl p-8 text-center border-2 border-blue-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-blue-700 mb-1">{{ total_animals|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-blue-400">Animals</div>
      </div>

      <div class="bg-white rounded-2xl p-8 text-center border-2 border-green-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-green-700 mb-1">{{ total_tasks|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-green-400">Tasks</div>
      </div>

      <div class="bg-white rounded-2xl p-8 text-center border-2 border-yellow-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-yellow-600 mb-1">{{ total_medical_records|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-yellow-400">Records</div>
      </div>

      <div class="bg-white rounded-2xl p-8 text-center border-2 border-purple-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-purple-700 mb-1">{{ total_notifications|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-purple-400">Notifications</div>
      </div>
    </section>

    <br>
    <br>

    <!-- Quick Actions -->
    <section class="mb-20 w-full">
      <h2 class="text-3xl font-light text-gray-900 mb-10 tracking-wide">Quick Actions</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 w-full">

        <a href="{% url 'add_medical_record' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-blue-300 shadow-sm hover:shadow-lg hover:bg-blue-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-blue-200 transition-colors">
            <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M12 4v16m8-8H4"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Medical Record</h3>
          <p class="text-gray-500 text-sm">Add new treatment</p>
        </a>

        <a href="{% url 'add_patient' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-green-300 shadow-sm hover:shadow-lg hover:bg-green-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-green-200 transition-colors">
            <svg class="w-7 h-7 text-green-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">New Patient</h3>
          <p class="text-gray-500 text-sm">Register animal</p>
        </a>

        <a href="{% url 'assign_task' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-yellow-300 shadow-sm hover:shadow-lg hover:bg-yellow-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-yellow-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-yellow-200 transition-colors">
            <svg class="w-7 h-7 text-yellow-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Assign Task</h3>
          <p class="text-gray-500 text-sm">Create assignment</p>
        </a>

        <a href="{% url 'analytics_dashboard' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-purple-300 shadow-sm hover:shadow-lg hover:bg-purple-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-purple-200 transition-colors">
            <svg class="w-7 h-7 text-purple-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Analytics</h3>
          <p class="text-gray-500 text-sm">View reports</p>
        </a>
      </div>
    </section>

    <br>
    <br>

    <!-- Recent Messages -->
    <section class="bg-white rounded-2xl p-8 border border-gray-300 shadow-sm w-full">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-light text-gray-900 tracking-wide">Messages</h2>
        <a href="{% url 'inbox' branch=branch %}"
           class="text-blue-600 hover:text-blue-800 font-semibold transition-colors duration-200">
          View all
        </a>
      </div>

      {% if recent_messages %}
        <div class="space-y-6">
          {% for msg in recent_messages %}
          <article class="flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0 hover:bg-blue-50 rounded px-4 transition-colors duration-200 cursor-pointer">
            <div>
              <h3 class="font-semibold text-gray-900 leading-tight">
                {{ msg.subject|default:"No subject" }}
              </h3>
              <p class="text-gray-600 text-sm mt-1">
                {{ msg.sender.get_full_name|default:msg.sender.username }}
              </p>
            </div>
            <time class="text-gray-400 text-sm font-mono">
              {{ msg.timestamp|date:"M j" }}
            </time>
          </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-16">
          <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-5">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <p class="text-gray-500 text-lg font-light">No messages yet</p>
        </div>
      {% endif %}
    </section>

  </div>
</div>

<script>
// Real-time online/offline status update
function updateOnlineStatus() {
  const statusIcon = document.getElementById('status-icon');
  const statusText = document.getElementById('status-text');
  if (navigator.onLine) {
    statusIcon.classList.remove('text-gray-400', 'animate-none');
    statusIcon.classList.add('text-green-500', 'animate-pulse');
    statusText.textContent = 'Online';
    statusText.classList.remove('text-gray-500');
    statusText.classList.add('text-gray-600');
  } else {
    statusIcon.classList.remove('text-green-500', 'animate-pulse');
    statusIcon.classList.add('text-gray-400', 'animate-none');
    statusText.textContent = 'Offline';
    statusText.classList.remove('text-gray-600');
    statusText.classList.add('text-gray-500');
  }
}

// Initial check
updateOnlineStatus();

// Listen for online/offline events
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
</script>
{% endblock %}
