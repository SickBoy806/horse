{% extends "veterinarian_dashboard/base_dashboard.html" %}

{% block dashboard_content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
  <div class="w-full min-h-screen py-12 px-4 sm:px-6 md:px-12">

    <!-- HEADER -->
    <header class="mb-6 w-full bg-white rounded-xl p-6 shadow-sm border border-gray-200/50">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">

        <!-- Left: Title + Icon -->
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-4-4V7a4 4 0 714-4h10a4 4 0 714 4v5a4 4 0 71-4 4H7z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6" />
            </svg>
          </div>
          <h1 class="text-2xl font-semibold text-gray-900 select-none">Veterinarian</h1>
        </div>

        <!-- Center: User info -->
        <div class="flex flex-col text-gray-600" aria-label="User greeting and branch">
          <div class="flex items-baseline gap-2 mb-1">
            <span class="text-sm text-gray-500">Welcome back,</span>
            <span class="font-semibold text-lg text-gray-900 select-text">Dr. {{ request.user.get_full_name|default:request.user.username }}</span>
          </div>
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.104 0 2-.896 2-2s-.896-2-2-2-2 .896-2 2 .896 2 2 2z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 22s8-4.5 8-10-3.582-8-8-8-8 3.582-8 8 8 10 8 10z" />
            </svg>
            <span class="text-sm font-medium text-blue-600 select-none">{{ branch|title }}</span>
          </div>
        </div>

        <!-- Right: Online Status -->
        <div id="online-status" class="flex items-center gap-2 text-sm font-medium select-none" aria-label="Online status">
          <div class="relative">
            <svg id="status-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 12.55a11 11 0 0114.08 0m-2.83 2.82a7 7 0 00-8.42 0m4.24 4.24a3 3 0 00-4.24 0" />
            </svg>
            <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
          </div>
          <span id="status-text" class="text-gray-600">Online</span>
        </div>

      </div>
    </header>

      <br>
      <br>

    <!-- STATS -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-20 w-full">
      <div class="bg-white rounded-2xl p-8 text-center border-2 border-blue-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-blue-700 mb-1" id="total-animals">{{ total_animals|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-blue-400">Animals</div>
      </div>
      <div class="bg-white rounded-2xl p-8 text-center border-2 border-green-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-green-700 mb-1" id="total-tasks">{{ total_tasks|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-green-400">Tasks</div>
      </div>
      <div class="bg-white rounded-2xl p-8 text-center border-2 border-yellow-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-yellow-600 mb-1" id="total-medical-records">{{ total_medical_records|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-yellow-400">Records</div>
      </div>
      <div class="bg-white rounded-2xl p-8 text-center border-2 border-purple-300 shadow-sm hover:shadow-md transition-shadow duration-300">
        <div class="text-4xl font-semibold text-purple-700 mb-1" id="total-notifications">{{ total_notifications|default:"0" }}</div>
        <div class="uppercase text-sm font-medium tracking-wide text-purple-400">Notifications</div>
      </div>
    </section>


      <br>
      <br>

    <!-- QUICK ACTIONS -->
    <section class="mb-20 w-full">
      <h2 class="text-3xl font-light text-gray-900 mb-10 tracking-wide">Quick Actions</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 w-full">

        <a href="{% url 'add_medical_record' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-blue-300 shadow-sm hover:shadow-lg hover:bg-blue-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-blue-200 transition-colors">
            <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M12 4v16m8-8H4"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Medical Record</h3>
          <p class="text-gray-500 text-sm">Add new treatment</p>
        </a>

        <a href="{% url 'add_patient' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-green-300 shadow-sm hover:shadow-lg hover:bg-green-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-green-200 transition-colors">
            <svg class="w-7 h-7 text-green-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">New Patient</h3>
          <p class="text-gray-500 text-sm">Register animal</p>
        </a>

        <a href="{% url 'assign_task' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-yellow-300 shadow-sm hover:shadow-lg hover:bg-yellow-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-yellow-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-yellow-200 transition-colors">
            <svg class="w-7 h-7 text-yellow-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Assign Task</h3>
          <p class="text-gray-500 text-sm">Create assignment</p>
        </a>

        <a href="{% url 'analytics_dashboard' branch=branch %}"
           class="group bg-white rounded-2xl p-8 border-2 border-purple-300 shadow-sm hover:shadow-lg hover:bg-purple-50 transition duration-300 flex flex-col items-center text-center">
          <div class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center mb-6 group-hover:bg-purple-200 transition-colors">
            <svg class="w-7 h-7 text-purple-600" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-1">Analytics</h3>
          <p class="text-gray-500 text-sm">View reports</p>
        </a>
      </div>
    </section>

      <br>
      <br>

    <!-- MESSAGES -->
    <section class="bg-white rounded-2xl p-8 border border-gray-300 shadow-sm w-full">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-light text-gray-900 tracking-wide">Messages</h2>
        <a href="{% url 'inbox' branch=branch %}" class="text-blue-600 hover:text-blue-800 font-semibold transition-colors duration-200">
          View all
        </a>
      </div>

      {% if recent_messages %}
        <div class="space-y-6">
          {% for msg in recent_messages %}
          <article class="flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0 hover:bg-blue-50 rounded px-4 transition-colors duration-200 cursor-pointer">
            <div>
              <h3 class="font-semibold text-gray-900 leading-tight">{{ msg.subject|default:"No subject" }}</h3>
              <p class="text-gray-600 text-sm mt-1">{{ msg.sender.get_full_name|default:msg.sender.username }}</p>
            </div>
            <time class="text-gray-400 text-sm font-mono">{{ msg.timestamp|date:"M j" }}</time>
          </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-16">
          <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-5">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <p class="text-gray-500 text-lg font-light">No messages yet</p>
        </div>
      {% endif %}
    </section>

  </div>
</div>

<!-- GSAP for animating numbers and message fade-in -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
  // Online/offline status logic
  function updateOnlineStatus() {
    const statusIcon = document.getElementById('status-icon');
    const statusText = document.getElementById('status-text');
    if (navigator.onLine) {
      statusIcon.classList.remove('text-gray-400', 'animate-none');
      statusIcon.classList.add('text-green-500', 'animate-pulse');
      statusText.textContent = 'Online';
      statusText.classList.remove('text-gray-500');
      statusText.classList.add('text-gray-600');
    } else {
      statusIcon.classList.remove('text-green-500', 'animate-pulse');
      statusIcon.classList.add('text-gray-400', 'animate-none');
      statusText.textContent = 'Offline';
      statusText.classList.remove('text-gray-600');
      statusText.classList.add('text-gray-500');
    }
  }
  updateOnlineStatus();
  window.addEventListener('online', updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);

  // Animate stat numbers from 0 to their values on page load
  function animateNumber(id, endValue) {
    const el = document.getElementById(id);
    if (!el) return;
    const startValue = parseInt(el.textContent) || 0;
    gsap.fromTo(el, { textContent: startValue }, {
      textContent: endValue,
      duration: 1.2,
      ease: "power1.out",
      snap: { textContent: 1 }
    });
  }

  // Animate all stat cards once DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    animateNumber('total-animals', parseInt(document.getElementById('total-animals').textContent) || 0);
    animateNumber('total-tasks', parseInt(document.getElementById('total-tasks').textContent) || 0);
    animateNumber('total-medical-records', parseInt(document.getElementById('total-medical-records').textContent) || 0);
    animateNumber('total-notifications', parseInt(document.getElementById('total-notifications').textContent) || 0);

    // Animate recent messages fade-in
    const messages = document.querySelectorAll('#recent-messages article, section.bg-white article');
    messages.forEach((msg, i) => {
      gsap.fromTo(msg, {opacity: 0, y: 10}, {opacity: 1, y: 0, duration: 0.4, delay: 0.1 * i});
    });
  });
</script>

{% endblock %}
